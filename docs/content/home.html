
<html><head></head><body><h2 align="center">bouncer üêª</h2>
<hr />

<p align="center">
  <a href="https://badge.fury.io/js/%40jacekpietal%2Fbouncer.js"><img src="https://badge.fury.io/js/%40jacekpietal%2Fbouncer.js.svg" alt="shield" style="max-width: 100%;"></a>
  <a href="https://circleci.com/gh/Prozi/bouncer.js"><img src="https://circleci.com/gh/Prozi/bouncer.js.svg?style=shield" alt="shield" style="max-width: 100%;"></a>
</p>

<p align="center">
  A simple multiple room manager for micro-WebSockets.
</p>

<h2 id="1-general-use-case">1. General use case</h2>
<hr />
<ul>
<li>You're only able to spawn one process and you'd like to have an app with rooms.</li>
<li>At the same time spawn X number of scalable microservices that can connect as websockets.</li>
</ul>
<h2 id="11-common-use-case">1.1 Common use case</h2>
<hr />
<ul>
<li>Single process app server like a free <code>heroku.com</code> account or similar</li>
<li>Building a chat</li>
<li>Making node + javascript games</li>
</ul>
<h2 id="2-installation">2. Installation</h2>
<hr />
<p>It's hosted as an <code>npm</code> package so installation is of course as simple as:</p>
<pre><code class="bash">npm i @jacekpietal/bouncer.js --registry https://registry.yarnpkg.com

# or yarn add @jacekpietal/bouncer.js --save</code></pre>
<hr>
<h2 id="3-api-">3. API:</h2>
<hr />
<p>Call to <code>new BouncerJs()</code></p>
<ol>
<li>Expects the following Object as argument:</li>
</ol>
<pre><code class="javascript">{
  plugins: {
    [plugin]: (ws, { event, id, data }) =&gt; {
      // user implementation
    }
  },
  LOGO: 'bouncer üêª',
  port: process.env.PORT,
  join: '/join',
  leave: '/leave',
  createSocketId: () =&gt; simpleId,
  debug: false,
}</code></pre>
<ol start="2">
<li>The plugins receive (and send) the data in the format of:</li>
</ol>
<pre><code>{
  id,    // WebSocket id
  event, // event name as string
  data,  // any data accompanying the event
}</code></pre>
<ol start="3">
<li><p>Each plugin is a function handling the topic of the room a.k.a. microservice name.</p>
</li>
<li><p>Creating instanceof BouncerJs returns following API:</p>
</li>
</ol>
<pre><code class="javascript">{
  onEvent(ws, event, data),
  join(ws, topic),
  leave(ws),
  broadcast({ topic }, data),
  send(ws, message),
  router: uws.SSLApp|uws.App,
  rooms: Map(),
  config: {},
}</code></pre>
<h3 id="31-read-more--with-types-and-parameters-">3.1 Read more (with types and parameters)</h3>
<p>In <a href="https://prozi.github.io/bouncer.js/api/">The API Documentation</a></p>
<hr>
<h2 id="4-chat--full-working-app--example-">4. Chat [full working app] example:</h2>
<hr />
<h3 id="41-nodejs-part-">4.1 Node.js part:</h3>
<pre><code class="javascript">const BouncerJs = require("../index.js");
const fs = require("fs");
const path = require("path");
const chat = require("../chat.js");

const indexFile = fs.readFileSync(path.resolve(__dirname, "index.html"), {
  encoding: "utf8",
});

const { router } = new BouncerJs({
  debug: true,
  plugins: { chat },
});

router.get("/*", (res, req) =&gt; {
  res.end(indexFile);
});</code></pre>
<h3 id="42-frontend-part-">4.2. Frontend part:</h3>
<pre><code class="javascript">const socket = new WebSocket("ws://localhost:1337");
const refs = ["username", "messages", "message", "chat"].reduce(
  (obj, id) =&gt; ({
    ...obj,
    [id]: document.querySelector(`#${id}`),
  }),
  {},
);

socket.onopen = (value) =&gt; {
  socket.send(JSON.stringify({ event: "/join", data: "chat" }));
};

socket.onmessage = ({ data: string }) =&gt; {
  const { id, event, data } = JSON.parse(string);

  if (!refs.username.innerText) {
    refs.username.innerText = id;
  }

  refs.messages.innerHTML += `&lt;div&gt;${id} &amp;gt; ${event} &amp;gt; ${data}&lt;/div&gt;\n`;
};

refs.chat.addEventListener("submit", (event) =&gt; {
  event.preventDefault();

  const { value: data } = refs.message;
  refs.message.value = "";
  socket.send(JSON.stringify({ event: "say", data }));
});</code></pre>
<h3 id="43-to-run-above-example-you-can-run-">4.3. To run above example you can run:</h3>
<pre><code class="bash">yarn test:chat</code></pre>
<p>And visit <code>http://localhost:8080</code> in your favourite Chrome browser or other.</p>
<hr>
<h2 id="5-configuration">5. Configuration</h2>
<hr />
<p>Configuration is default, being extended with provided by user.</p>
<p>see <a href="https://github.com/Prozi/bouncer.js/blob/master/config.js">config.js</a></p>
<hr>
<p>To see complimentary RAW frontend of above chat:</p>
<p>see <a href="https://github.com/Prozi/bouncer.js/blob/master/index.html">index.html</a></p>
<hr>
<h2 id="6-backwards-compatibility">6. Backwards compatibility</h2>
<hr />
<p>For the few users to have somewhat of a bridge between the <a href="https://github.com/Prozi/socket-starter">socket-starter</a> library that this library deprecates:</p>
<ul>
<li>see <a href="https://github.com/Prozi/bouncer.js/blob/master/socket-starter.shim.js">socket-starter.shim.js</a></li>
<li>see <a href="https://github.com/Prozi/bouncer.js/blob/master/socket-starter.shim.spec.js">socket-starter.shim.spec.js</a></li>
</ul>
<h3 id="61-what-does-this-do-">6.1. What does this do?</h3>
<p>if you do <code>shim(plugin)</code> then your plugin may be in the format of:</p>
<pre><code class="javascript">{
  initialize(io)
  handshake(socket, data),
}</code></pre>
<p>shim adds to your plugin</p>
<hr>
<h2 id="7-tests">7. Tests</h2>
<hr />
<table>
<thead>
<tr>
<th>Name</th>
<th>Count</th>
</tr>
</thead>
<tbody><tr>
<td>Test Suites:</td>
<td>3 passed, 3 total</td>
</tr>
<tr>
<td>Tests:</td>
<td>14 passed, 14 total</td>
</tr>
<tr>
<td>Snapshots:</td>
<td>0 total</td>
</tr>
<tr>
<td>Time:</td>
<td>1.009 s</td>
</tr>
</tbody></table>
<p>To test run:</p>
<ul>
<li><code>yarn test</code> (automatic)</li>
<li><code>yarn test:chat</code> (manual)</li>
</ul>
<hr>
<h2 id="8-front-end-client--beta-">8. Front End Client (beta)</h2>
<hr />
<ul>
<li>see <a href="https://github.com/Prozi/bouncer.js/blob/master/client.js">client.js</a></li>
<li>see <a href="https://github.com/Prozi/bouncer.js/blob/master/client.spec.js">client.spec.js</a></li>
</ul>
<p>Standard frontend WebSocket extended with:</p>
<pre><code>{
  emit(objectOrString)
  on(eventName, callback)
  on("*", callback) // on any event
}</code></pre>
<hr>
<h2 id="9-license">9. License</h2>
<hr />
<p>MIT</p>
<ul>
<li>Do what you want, fork, etc.</li>
<li>I am not responsible for any problem this free application causes :P</li>
</ul>
<p>have fun, please open any issues, etc.</p>
<h2 id="10-author">10. Author</h2>
<hr />
<ul>
<li>Jacek Pietal</li>
</ul>
</body></html>